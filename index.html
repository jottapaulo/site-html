<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Paran√° Pe√ßas Toledo</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Exo+2:wght@700&display=swap" rel="stylesheet">
  <style>
    /* --- (seu CSS igualzinho, n√£o alterei nada) --- */
  </style>
</head>
<body>

<header>
  <div class="brand">PARAN√Å PE√áAS TOLEDO</div>
  <div class="social-links">
    <a href="https://www.paranapecastoledo.com.br" target="_blank" class="brand-link">
      <img src="pictures/logo.png" alt="Site Oficial" class="social-icon"> SITE OFICIAL
    </a>
    <a href="https://www.mercadolivre.com.br/pagina/paranapeastoledo" target="_blank" class="brand-link">
      <img src="pictures/logo_mercadoLivre.png" alt="Mercado Livre" class="social-icon"> MERCADO LIVRE
    </a>
    <a href="https://www.instagram.com/pr_pecas/" target="_blank" class="brand-link">
      <img src="pictures/logo_instagram.png" alt="Instagram" class="social-icon"> INSTAGRAM
    </a>
  </div>
</header>

<main>
  <h1>Remover Fundo de Imagens</h1>
  <p>Envie suas fotos e obtenha imagens PNG em segundos.</p>

  <label class="upload-area" id="uploadArea">
    <input type="file" id="inputImagem" multiple hidden>
    <button class="btn">‚ûï Iniciar com foto</button>
    <p class="sub-text">ou solte uma imagem aqui</p>
  </label>

  <div class="preview" id="preview" style="display:none;"></div>

  <div class="action-buttons">
    <button class="btn" id="processarBtn" style="display:none;">PROCESSAR</button>
    <button class="btn btn-clear" id="limparBtn" style="display:none;">üóëÔ∏è</button>
  </div>

  <!-- Loader circular compacto -->
  <div id="loaderContainer">
    <div id="loaderCircle"></div>
    <div id="loaderText">0%</div>
  </div>

  <div class="results" id="results"></div>
  <button class="btn" id="baixarTodasBtn" style="display:none;">Salvar Todas</button>
</main>

<footer>
  <p>&copy; 2025 <a href="#">Paran√° Pe√ßas Toledo</a>. Todos os direitos reservados.</p>
</footer>

<script>
const dropArea = document.getElementById("uploadArea");
const input = document.getElementById("inputImagem");
const preview = document.getElementById("preview");
const processarBtn = document.getElementById("processarBtn");
const limparBtn = document.getElementById("limparBtn");
const results = document.getElementById("results");
const baixarTodasBtn = document.getElementById("baixarTodasBtn");
const loaderContainer = document.getElementById("loaderContainer");
const loaderText = document.getElementById("loaderText");
let processedFiles = [];

// Abrir explorador de arquivos
dropArea.addEventListener("click", () => input.click());

// Pr√©-visualiza√ß√£o de imagens
input.addEventListener("change", () => {
  if (input.files.length > 0) {
    dropArea.style.display = "none";
    preview.style.display = "flex";
    processarBtn.style.display = "inline-block";
    limparBtn.style.display = "inline-block";
  }
  preview.innerHTML = "";
  [...input.files].forEach(file => {
    const reader = new FileReader();
    reader.onload = e => {
      const img = document.createElement("img");
      img.src = e.target.result;
      preview.appendChild(img);
    };
    reader.readAsDataURL(file);
  });
});

// Drag & drop
["dragenter","dragover"].forEach(eventName => {
  dropArea.addEventListener(eventName, e => {
    e.preventDefault();
    dropArea.classList.add("dragover");
  });
});
["dragleave","drop"].forEach(eventName => {
  dropArea.addEventListener(eventName, e => {
    e.preventDefault();
    dropArea.classList.remove("dragover");
  });
});
dropArea.addEventListener("drop", e => {
  e.preventDefault();
  input.files = e.dataTransfer.files;
  input.dispatchEvent(new Event("change"));
});

// Processar imagens
processarBtn.addEventListener("click", async () => {
  if (!input.files.length) return alert("Selecione imagens primeiro!");
  
  loaderContainer.style.display = "block";
  results.innerHTML = "";
  processedFiles = [];

  const files = [...input.files];
  for (let i = 0; i < files.length; i++) {
    const file = files[i];
    const formData = new FormData();
    formData.append("imagens", file);

    try {
      // üîó Troque pelo link do Render quando tiver o deploy
      const response = await fetch("https://removedorbackground.onrender.com", {
        method: "POST",
        body: formData
      });
      const data = await response.json();
      const imgBase64 = data[0];

      const div = document.createElement("div");
      div.className = "result-item";

      const img = document.createElement("img");
      img.src = "data:image/png;base64," + imgBase64;

      const btn = document.createElement("button");
      btn.textContent = "Salvar";
      btn.className = "download-btn";
      btn.onclick = () => {
        const a = document.createElement("a");
        a.href = img.src;
        a.download = "processada_" + (i+1) + ".png";
        a.click();
      };

      div.appendChild(img);
      div.appendChild(btn);
      results.appendChild(div);
      processedFiles.push(img.src);

      // Atualiza porcentagem do loader
      const percent = Math.round(((i+1) / files.length) * 100);
      loaderText.textContent = percent + "%";

    } catch (err) {
      console.error(err);
      alert("Erro ao processar a imagem " + (i+1));
    }
  }

  loaderContainer.style.display = "none";
  baixarTodasBtn.style.display = "inline-block";
});

// Limpar tudo
limparBtn.addEventListener("click", () => {
  input.value = "";
  preview.innerHTML = "";
  results.innerHTML = "";
  processedFiles = [];
  dropArea.style.display = "flex";
  processarBtn.style.display = "none";
  limparBtn.style.display = "none";
  baixarTodasBtn.style.display = "none";
  loaderContainer.style.display = "none";
  loaderText.textContent = "0%";
});

// Baixar todas
baixarTodasBtn.addEventListener("click", () => {
  processedFiles.forEach((src, idx) => {
    const a = document.createElement("a");
    a.href = src;
    a.download = "processada_" + (idx+1) + ".png";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  });
});
</script>

</body>
</html>
